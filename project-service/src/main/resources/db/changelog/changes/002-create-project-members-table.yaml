databaseChangeLog:
  - changeSet:
      id: create-project-members-table
      author: whatever125
      changes:
        - createTable:
            tableName: project_members
            columns:
              - column: { name: project_id, type: BIGINT, constraints: { nullable: false } }
              - column: { name: user_id, type: BIGINT, constraints: { nullable: false } }
              - column: { name: role, type: VARCHAR(20), constraints: { nullable: false } }
              - column: { name: joined_at, type: TIMESTAMPTZ, constraints: { nullable: false }, defaultValueComputed: CURRENT_TIMESTAMP }

        - addPrimaryKey:
            tableName: project_members
            columnNames: project_id,user_id
            constraintName: pk_project_members

        - addForeignKeyConstraint:
            baseTableName: project_members
            baseColumnNames: project_id
            referencedTableName: projects
            referencedColumnNames: id
            constraintName: fk_project_members_project_id
            onDelete: CASCADE

        - addUniqueConstraint:
            tableName: project_members
            columnNames: project_id,user_id
            constraintName: uk_project_members_project_user

        - createIndex:
            tableName: project_members
            indexName: idx_project_members_project
            columns:
              - column: { name: project_id }